
# Звіт по вирішеним заявкам

## Опис
У цьому проєкті реалізовано інтерфейс для створення звітів за заявками клієнтів. Заявки мають такі властивості:
- Статус: `Нова`, `В роботі`, `Вирішена`.
- Категорія: `Відключення`, `Перевірка/здешевлення`, `Технічне питання`, `Інше`.
- Дата створення.
- Дата вирішення.
- Агент, який вирішив заявку.
- Опис заявки.

### Основні функції:
- **Форма пошуку за діапазоном дат**: вибір дати вирішення заявки.
- **Вивід звіту**: у вигляді таблиці з розподілом по категоріях та загальною кількістю вирішених заявок.

---

## Вимоги
- PHP >= 7.4
- Yii2 >= 2.0.44
- MySQL >= 5.7
- Composer для встановлення залежностей.

---

## Установка
1. Клонувати репозиторій:
   ```bash
   git clone https://github.com/Vla-DOS-15/test-task.git
   ```

2. Перейти в директорію проєкту:
   ```bash
   cd project
   ```

3. Встановити залежності через Composer:
   ```bash
   composer install
   ```

4. Налаштувати файл конфігурації бази даних у `config/db.php`:
   ```php
   return [
       'class' => 'yii\db\Connection',
       'dsn' => 'mysql:host=localhost;dbname=test_task',
       'username' => 'root',
       'password' => '',
       'charset' => 'utf8',
   ];
   ```

5. Запустити міграції для створення таблиць:
   ```bash
   php yii migrate
   ```

6. Запустити вбудований сервер:
   ```bash
   php yii serve
   ```

---

## Структура таблиць

1. **Таблиця `tickets`**:
   | Поле         | Тип         | Опис                          |
   |--------------|-------------|-------------------------------|
   | `id`         | INT         | Первинний ключ               |
   | `agent_id`   | INT         | Ідентифікатор агента         |
   | `category_id`| INT         | Ідентифікатор категорії      |
   | `status`     | VARCHAR     | Статус заявки                |
   | `created_at` | DATETIME    | Дата створення заявки        |
   | `resolved_at`| DATETIME    | Дата вирішення заявки        |
   | `description`| TEXT        | Опис заявки                  |

2. **Таблиця `agents`**:
   | Поле  | Тип     | Опис                          |
   |-------|---------|-------------------------------|
   | `id`  | INT     | Первинний ключ               |
   | `name`| VARCHAR | Ім'я агента                  |

3. **Таблиця `categories`**:
   | Поле  | Тип     | Опис                          |
   |-------|---------|-------------------------------|
   | `id`  | INT     | Первинний ключ               |
   | `name`| VARCHAR | Назва категорії              |

---

## Використання
1. Відкрийте у браузері [http://localhost:8080](http://localhost:8080).
2. У формі виберіть діапазон дат вирішення заявок і натисніть кнопку "Пошук".
3. Таблиця покаже результати у вигляді:
   | ПІБ               | Відключення | Перевірка/здешевлення  | Тех. питання | Інше  | Усього |
   |-------------------|-------------|------------------------|--------------|-------|--------|
   | Таран Ольга       | 161         | 145                    | 108          | 29    | 443    |
   | Неделько Дмитрий  | 159         | 181                    | 133          | 24    | 497    |

---

## Як працює
1. **Форма пошуку** дозволяє вводити діапазон дат.
2. **SQL-запит** генерує статистику по категоріях, використовуючи `CASE WHEN` і `COUNT`.
3. **Таблиця результатів** відображає згенеровані дані.

---

## Приклад SQL-запиту
```sql
SELECT 
    a.name AS agent_name,
    COUNT(CASE WHEN c.name = 'Відключення' THEN 1 END) AS disconnect_count,
    COUNT(CASE WHEN c.name = 'Перевірка/здешевлення' THEN 1 END) AS verification_count,
    COUNT(CASE WHEN c.name = 'Технічне питання' THEN 1 END) AS technical_count,
    COUNT(CASE WHEN c.name = 'Інше' THEN 1 END) AS other_count,
    COUNT(t.id) AS total_count
FROM tickets t
INNER JOIN agents a ON t.agent_id = a.id
INNER JOIN categories c ON t.category_id = c.id
WHERE t.status = 'Вирішена'
  AND t.resolved_at BETWEEN '2025-01-01' AND '2025-12-31'
GROUP BY t.agent_id
ORDER BY a.name;
```
